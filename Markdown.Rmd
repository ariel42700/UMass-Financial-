---
title: "CheapMass"
output: html_document
author: "Alain Duplan & Ariel Lutati"
---


```{r}
library(readxl)
library(TTR)
library(forecast)
library(tree)
library(randomForest)
library(janitor)
```
```{r}
CashFlows <- read_excel("UMass Balance sheets.xlsx", sheet = 1)
#CashFlows <- as.data.frame(t(CashFlows))
original <- CashFlows
tuition <- CashFlows[2,]
names(CashFlows)
CashFlows <- subset(CashFlows, Nets == "1")
CashFlows <- rbind(CashFlows, tuition)
```

```{r}
train <- CashFlows[,2:4]
test <- CashFlows[,c(5:6)]
train <- as.data.frame(t(train))
test <- as.data.frame(t(test))
```
```{r}
seed.val <- 1234567
set.seed(seed.val)
```

```{r}
train.forest <- randomForest(V12 ~.,data = train, mtry  = 4, importance = T)
#varImpPlot(train.forest)
train.pred <- predict(train.forest, train)
train.forest.pred.ts <- ts((as.numeric(as.vector(train.pred))), frequency = 1, start = c(2015, 1))
train.ts <- ts((as.numeric(as.vector(train$V12))), frequency = 1, start = c(2015, 1))

ts.plot(train.forest.pred.ts, train.ts, gpars = list(col=rainbow(2))) 
legend("topright", legend = c("predictions", "true"), col = rainbow((2)), lty = 1)
```

```{r}
#par(mfrow= c(1,2))
train.rmse <- rmse(train$V12, train.pred)
#23,161,920.7
train.res = train.pred - train$V12

train.res.ts <- ts((as.numeric(as.vector(train.res))), frequency = 1, start = c(2015, 1))
ts.plot(train.res.ts, xlab = "Year", ylab = "Cost in $", main = "residuals")

hist(train.res)
```